
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Input and output of atomic structures &#8212; workflow  documentation</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Automatic parallelization of tasks" href="code_structure.parallelisation.html" />
    <link rel="prev" title="Code structure" href="code_structure.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      
      
      <h1 class="site-logo" id="site-title">workflow  documentation</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Contents:
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="install.html">
   Instalation
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="code_structure.html">
   Code structure
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Input and output of atomic structures
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="code_structure.parallelisation.html">
     Automatic parallelization of tasks
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="operations.html">
   Operations
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="operations.calculators.html">
     Calculators in workflow
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="operations.generating_configs.html">
     Generating Configs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="operations.selecting_configs.html">
     Selecting Configs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="operations.gap_fitting.html">
     Multistage GAP fitting
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="operations.plots.html">
     Plots
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="operations.misc.html">
     Miscellaneous
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="workflows.html">
   Workflows
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="workflows.rss.html">
     How to do GAP-RSS
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="workflows.collisions.html">
     Collisions
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="command_line.html">
   Command line interface
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="simple">
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="examples.html">
   Examples
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="contributing.html">
   How to contribute
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="modules.html">
   API
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="wfl.html">
     wfl package
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
    <label for="toctree-checkbox-6">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="wfl.calculators.html">
       wfl.calculators package
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="wfl.cli.html">
       wfl.cli package
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="wfl.fit.html">
       wfl.fit package
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
      <label for="toctree-checkbox-7">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="wfl.fit.modify_database.html">
         wfl.fit.modify_database package
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="wfl.generate_configs.html">
       wfl.generate_configs package
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="wfl.pipeline.html">
       wfl.pipeline package
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="wfl.plotting.html">
       wfl.plotting package
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="wfl.reactions_processing.html">
       wfl.reactions_processing package
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="wfl.select_configs.html">
       wfl.select_configs package
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="wfl.utils.html">
       wfl.utils package
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/code_structure.configset.rst.txt"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.rst</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Input and output of atomic structures</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="section" id="input-and-output-of-atomic-structures">
<span id="configset"></span><h1>Input and output of atomic structures<a class="headerlink" href="#input-and-output-of-atomic-structures" title="Permalink to this headline">Â¶</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">ConfigSet_in</span></code> and <code class="docutils literal notranslate"><span class="pre">ConfigSet_out</span></code> are python classes defined in <code class="docutils literal notranslate"><span class="pre">configset.py</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wfl.configset</span> <span class="kn">import</span> <span class="n">ConfigSet_in</span><span class="p">,</span> <span class="n">ConfigSet_out</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">ConfigSet_in</span></code> can encapsulate one or multiple lists of <code class="docutils literal notranslate"><span class="pre">ase.atoms.Atoms</span></code> objects, or reference to stored sets of configuration in files or ABCD databases. It can function as an iterator over all configs in the input, or iterate over groups of them according to the input definition with the <code class="docutils literal notranslate"><span class="pre">ConfigSet_in().group_iter()</span></code> method. The <code class="docutils literal notranslate"><span class="pre">ConfigSet_in</span></code> must be initialized with its inputs and indices for them.</p>
<p><code class="docutils literal notranslate"><span class="pre">ConfigSet_out</span></code> works as the output layer, can be used for writing results into it during iterations, but the actual writing is only happening when the operation is closed with <code class="docutils literal notranslate"><span class="pre">ConfigSet_out.end_write()</span></code>. Input mapping can be added to output into multiple files, based on the input. This is not fully functional for putting configs into the different outputs in a random order and repeatedly touching one.</p>
<p>For example, to read from two files and write corresponding configs to two other files, use</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">s_in</span> <span class="o">=</span> <span class="n">ConfigSet_in</span><span class="p">(</span><span class="n">input_files</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;in1.xyz&#39;</span><span class="p">,</span><span class="s1">&#39;dir/in2.xyz&#39;</span><span class="p">])</span>
<span class="n">s_out</span> <span class="o">=</span> <span class="n">ConfigSet_out</span><span class="p">(</span><span class="n">output_files</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;in1.xyz&quot;</span><span class="p">:</span> <span class="s2">&quot;out1.xyz&quot;</span><span class="p">,</span> <span class="s2">&quot;in2.xyz&quot;</span><span class="p">:</span> <span class="s2">&quot;out2.xyz&quot;</span><span class="p">})</span>
<span class="k">for</span> <span class="n">at</span> <span class="ow">in</span> <span class="n">s_in</span><span class="p">:</span>
    <span class="n">do_some_operation</span><span class="p">(</span><span class="n">at</span><span class="p">)</span>
    <span class="n">s_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">at</span><span class="p">,</span> <span class="n">from_input_file</span><span class="o">=</span><span class="n">s_in</span><span class="o">.</span><span class="n">get_current_input_file</span><span class="p">())</span>
<span class="n">s_out</span><span class="o">.</span><span class="n">end_write</span><span class="p">()</span>
</pre></div>
</div>
<p>In this case the inputs is a list of files, and the outputs is either a single file (many -&gt; 1) or a mapping between equal number of input and output categories (multiple 1 -&gt; 1). This will not overwrite unless you also pass <code class="docutils literal notranslate"><span class="pre">force=True</span></code>.</p>
<p>To read from and write to ABCD database records, you can do</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">output_tags</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;output_tag&#39;</span> <span class="p">:</span> <span class="s1">&#39;some unique value&#39;</span><span class="p">}</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">ConfigSet</span><span class="p">(</span><span class="n">input_abcd</span><span class="o">=</span><span class="s1">&#39;mongodb://localhost:27017&#39;</span> <span class="n">inputs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;input_tag&#39;</span> <span class="p">:</span> <span class="s1">&#39;necessary_input-val&#39;</span><span class="p">},</span>
            <span class="n">output_abcd</span><span class="o">=</span><span class="s1">&#39;mongodb://localhost:27017&#39;</span><span class="p">,</span> <span class="n">output_tags</span><span class="o">=</span><span class="n">output_tags</span><span class="p">)</span>
</pre></div>
</div>
<p>In this case the inputs are a dict (single query, AND for each key-value pair) or list of dict for queries (multiple queries, OR of all the dicts), and the output tags are a dict of tags and values to set on writing.  Unless <code class="docutils literal notranslate"><span class="pre">output_force=True</span></code>, this will refuse  to write if any config already has the output tags set (to ensure  that all the configurations written by the loop can be retrieved exactly, for  passing to the next stage in the pipeline).  The outputs can be retrieved by</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">abcd</span><span class="o">.</span><span class="n">get_atoms</span><span class="p">(</span><span class="n">output_tags</span><span class="p">)</span>
</pre></div>
</div>
</div>


              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="code_structure.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Code structure</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="code_structure.parallelisation.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Automatic parallelization of tasks</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By N. Bernstein, T. K. Stenczel, E. Gelzinyte<br/>
    
        &copy; Copyright .<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>